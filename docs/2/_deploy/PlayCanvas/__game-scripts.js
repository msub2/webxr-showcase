var Xr=pc.createScript("xr");Xr.attributes.add("button",{type:"entity"}),Xr.attributes.add("camera",{type:"entity"}),Xr.prototype.initialize=function(){this.button.button.active=this.app.xr.supported,this.button.element.on("click",(function(){this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(t){"granted"==t&&window.addEventListener("deviceorientation",function(t){this.camera.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR)}.bind(this))}.bind(this)).catch(console.error):this.camera.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR))}),this)},Xr.prototype.update=function(t){};var Controller=pc.createScript("controller");Controller.prototype.initialize=function(){this.moveVector=new pc.Vec3,this.headRot=new pc.Mat4,this.camera=this.app.scene.root.findByName("Camera"),this.player=this.app.scene.root.findByName("Player"),this.fly=!1,this.speed=5},Controller.prototype.setInputSource=function(t){this.inputSource=t,this.inputSource.once("remove",this.onRemove,this)},Controller.prototype.onRemove=function(){this.entity.destroy()},Controller.prototype.update=function(t){this.inputSource.grip&&(this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation())),this.move(t)},Controller.prototype.move=function(t){let e=this.inputSource.gamepad.axes;this.moveVector.set(e[2],0,e[3]).normalize(),this.headRot.setFromEulerAngles(this.camera.getLocalRotation().getEulerAngles()),this.fly||this.headRot.setFromEulerAngles(0,this.camera.getLocalRotation().getEulerAngles().y,0),this.moveVector.copy(this.headRot.transformVector(this.moveVector)),this.moveVector.mulScalar(this.speed*t),this.player.translate(this.moveVector)};var Player=pc.createScript("player");Player.attributes.add("controller",{type:"asset",assetType:"template"}),Player.attributes.add("player",{type:"entity"}),Player.prototype.initialize=function(){this.app.xr.input.on("add",this.onAdd,this)},Player.prototype.onAdd=function(t){var e=this.controller.resource.instantiate();e.script.controller.setInputSource(t),this.player.addChild(e)};